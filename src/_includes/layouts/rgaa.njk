{% extends './base.njk' %}
{% block contenu %}
	<div id="summary" class="summary">
		<p>Accéder directement à la thématique de votre choix :</p>
		<ul class="fr-tags-group">
			{% for c in collections.criteriaAndTests %}
				{% set themeNum = c.themeNum %}
				{% set tests = c.tests %}
				{% set annexeCrit = c.annexeCrit %}
				{% if themeNum != curThemeNum %}
					<li><a class="fr-tag fr-tag fr-tag--ecume" href="#{{ themeNum }}">{{ themeNum }}.  {{ themes[themeNum].title }}</a></li>
				{% endif %}
				{% set curThemeNum = themeNum %}
			{% endfor %}
		</ul>
		<div class="fr-toggle">
				<input disabled type="checkbox" class="fr-toggle__input" id="allCriterion">
				<label class="fr-toggle__label" for="allCriterion">Affichage du détail de tous les critères</label>
		</div>
	</div>
	{% set curThemeNum = 0 %}
	{% for c in collections.criteriaAndTests %}
		{% set crit = c.criterion %}
		{% set critNum = c.critNum %}
		{% set themeNum = c.themeNum %}
		{% set tests = c.tests %}
		{% set annexeCrit = c.annexeCrit %}
		{% if themeNum > 1 and themeNum !== curThemeNum %}
			</ul>
		{% endif %}

		{% if themeNum !== curThemeNum %}
			{% set curThemeNum = themeNum %}
			<h2 id="{{ themeNum }}">{{ themeNum }}.&nbsp;{{ themes[themeNum].title }} <!--a class="direct-link" href="#{{ themeNum }}">#</a--></h2>
			<ul>
		{% endif %}

		<li class="criterion"><!--a class="direct-link" href="#{{ critNum }}">#</a-->
			<h3 class="fr-accordion__title" id="{{ critNum }}"><span class="crit">{{ critNum }}</span> {{ crit.data.title | markdownInline | safe | replace("#","/ressources/glossaire/#")}}</h3>
			<button aria-expanded="false" aria-controls="fr-{{ critNum }}" class=" fr-accordion__btn">Tests et références du critère {{ critNum }}</button>
			<div id="fr-{{ critNum }}" class="fr-collapse">
			<div class="fr-accordion__inner ">
				<div class="tests">
				{% for t in tests %}
					<div class="fr-mb-4w test" id="{{ t.testSlug }}">
						<h4 class="fr-h5">Test {{ t.testSlug }} <!--a class="direct-link" href="#{{ t.testSlug }}">#</a--></h4>
						<p>{{ t.test.data.title | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}</p>
						{% if t.test.data.steps %}
						<ul>
						{% for step in t.test.data.steps %}
							<li>{{ step | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}</li>
						{% endfor %}
						</ul> 
						{% endif %}
						{% if t.test.templateContent != "" %}
							<div class="methodologie">
								<p>Méthodologie de test :</p>
								{{ t.test.templateContent | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}
							</div>
						{% endif %}
					</div>
				{% endfor %}
				</div>
				<div class="annexes ref">
					{{ annexeCrit.templateContent | safe | replace("#","/ressources/glossaire/#") }}
					<h4>Références <small>(en anglais)</small></h4>
					
					{% if annexeCrit.data.WCAG != null %}
						<h5><abbr lang="en" title="Web content accessibility guidelines">WCAG</abbr></h5>
					<ul class="wcag">
						{% for wcag in annexeCrit.data.WCAG %}
						<li><a href="https://www.w3.org/TR/WCAG21/#{{ wcag.title  | lower | replace(" ", "-") | replace(",", "") | replace("(", "") | replace(")", "")}}" target="_blank" title="critère {{ wcag.successCriterion }} - nouvelle fenêtre">{{ wcag.successCriterion }}</a> <span lang="en">{{ wcag.title }}</span> ({{ wcag.level }})</li>
						{% endfor %}
					</ul>
					{% endif %}
					{% if annexeCrit.data.Techniques != null %}
						<h5>Techniques</h5>
						<ul class="technique">
							{% for technique in annexeCrit.data.Techniques %}
							{% set firstLetter = technique | first %}
							{% if firstLetter == "A" %}
								{% set path = "aria" %}
							{% elif firstLetter ==  "C" %}
								{% set path = "css" %}
							{% elif firstLetter ==  "F" %}
								{% set path = "failures" %}
							{% elif firstLetter ==  "G" %}
								{% set path = "general" %}
							{% elif firstLetter ==  "H" %}
								{% set path = "html" %}
							{% elif firstLetter ==  "S" %}
								{% set secondLetter = technique | slice(1) %}
								{% if "C" == secondLetter %}
									{% set path = "client-side-script" %}
								{% else %}
									{% set path = "smil" %}
								{% endif %}                                   
							{% endif %}
							<li><a target="_blank" title="{{ technique }} - nouvelle fenêtre" href="https://www.w3.org/WAI/WCAG21/Techniques/{{ path }}/{{ technique }}">{{ technique }}</a></li>
							{% endfor %}
						</ul>
					{% endif %}
				</div>
				</div>
			</div>
		</li>
	{% endfor %}
	</ul>

{% endblock %}


