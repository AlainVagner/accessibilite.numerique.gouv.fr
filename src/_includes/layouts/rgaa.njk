{% extends './base-rgaaNav.njk' %}
{% block contenu %}
<div id="criteria-filters" class="summary">
	<div class="fr-form-group">
		<fieldset class="fr-fieldset fr-fieldset--inline">
			<legend class="fr-fieldset__legend fr-text--regular" id='checkboxes-inline-legend'>Filtres de consultation</legend>
			<div class="fr-fieldset__content">
				<div class="fr-checkbox-group">
					<input type="checkbox" id="checkboxes-inline-1" name="checkboxes-inline-1" data-filter="all">
					<label class="fr-label" for="checkboxes-inline-1">Afficher les tests</label>
				</div>
				<div class="fr-checkbox-group">
					<input type="checkbox" id="checkboxes-inline-2" checked name="checkboxes-inline-2" data-filter="A">
					<label class="fr-label" for="checkboxes-inline-2">Niveau WCAG A</label>
				</div>
				<div class="fr-checkbox-group">
					<input type="checkbox" id="checkboxes-inline-3" checked name="checkboxes-inline-3" data-filter="AA">
					<label class="fr-label" for="checkboxes-inline-3">Niveau WCAG AA</label>
				</div>
			</div>
		</fieldset>
	</div>
	<!--div class="fr-toggle">
				<input disabled type="checkbox" class="fr-toggle__input" id="allCriterion">
				<label class="fr-toggle__label" for="allCriterion">Affichage du détail de tous les critères</label>
	</div-->
</div>
<div id="criteria-container">
	{% set curThemeNum = 0 %}
	{% for c in collections.criteriaAndTests %}
		{% set crit = c.criterion %}
		{% set critNum = c.critNum %}
		{% set themeNum = c.themeNum %}
		{% set tests = c.tests %}
		{% set annexeCrit = c.annexeCrit %}
		{% set wcagLevels = "" %}

		{% if themeNum > 1 and themeNum !== curThemeNum %}
			</ul>
		{% endif %}
		{% if themeNum !== curThemeNum %}
			{% set curThemeNum = themeNum %}
			<h2 id="{{ themeNum }}">{{ themeNum }}.&nbsp;{{ themes[themeNum].title }} <!--a class="direct-link" href="#{{ themeNum }}">#</a--></h2>
			<ul>
		{% endif %}

		{% for wcag in annexeCrit.data.WCAG %}
		  {% set wcagLevels = wcagLevels + wcag.level + "," %}
		{% endfor %}

		<li class="criterion" data-wcag-level="{{ wcagLevels }}"><!--a class="direct-link" href="#{{ critNum }}">#</a-->

			<h3 class="fr-accordion__title">
			<a class="ancre" href="#{{ critNum }}" id="{{ critNum }}"><svg role="img" aria-label="Critère {{ critNum }}" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&nbsp;<span class="crit">{{ critNum }}</span>
			{{ crit.data.title | markdownInline | safe | replace("#","/ressources/glossaire/#")}}
			</h3>
			<button aria-expanded="false" aria-controls="fr-{{ critNum }}" class=" fr-accordion__btn">Tests et références du critère {{ critNum }}</button>
			<div id="fr-{{ critNum }}" class="fr-collapse">
			<div class="fr-accordion__inner ">
				<div class="tests">
				{% for t in tests %}
					<div class="fr-mb-4w test" id="{{ t.testSlug }}">
						<h4 class="fr-h5">Test {{ t.testSlug }} <!--a class="direct-link" href="#{{ t.testSlug }}">#</a--></h4>
						<p>{{ t.test.data.title | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}</p>
						{% if t.test.data.steps %}
						<ul>
						{% for step in t.test.data.steps %}
							<li>{{ step | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}</li>
						{% endfor %}
						</ul>
						{% endif %}
						{% if t.test.templateContent != "" %}
							<div class="methodologie">
								<p>Méthodologie de test :</p>
								{{ t.test.templateContent | markdownInline | safe  | replace("#","/ressources/glossaire/#") }}
							</div>
						{% endif %}
					</div>
				{% endfor %}
				</div>
				<div class="annexes ref">
					{{ annexeCrit.templateContent | safe | replace("#","/ressources/glossaire/#") }}
					<h4 class="fr-h5 fr-my-1w">Références <small>(en anglais)</small></h4>

					{% if annexeCrit.data.WCAG != null %}
						<h5 class="fr-h6 fr-mb-1w"><abbr lang="en" title="Web content accessibility guidelines">WCAG</abbr></h5>
					<ul class="wcag ">
						{% for wcag in annexeCrit.data.WCAG %}
						<li class="fr-text--sm fr-mb-1w"><a href="https://www.w3.org/TR/WCAG21/#{{ wcag.title  | lower | replace(" ", "-") | replace(",", "") | replace("(", "") | replace(")", "")}}" target="_blank" title="critère {{ wcag.successCriterion }} - nouvelle fenêtre">{{ wcag.successCriterion }}</a> <span lang="en">{{ wcag.title }}</span> ({{ wcag.level }})</li>
						{% endfor %}
					</ul>
					{% endif %}
					{% if annexeCrit.data.Techniques != null %}
						<h5 class="fr-h6 fr-mb-1w">Techniques</h5>
						<ul class="technique">
							{% for technique in annexeCrit.data.Techniques %}
							{% set firstLetter = technique | first %}
							{% if firstLetter == "A" %}
								{% set path = "aria" %}
							{% elif firstLetter ==  "C" %}
								{% set path = "css" %}
							{% elif firstLetter ==  "F" %}
								{% set path = "failures" %}
							{% elif firstLetter ==  "G" %}
								{% set path = "general" %}
							{% elif firstLetter ==  "H" %}
								{% set path = "html" %}
							{% elif firstLetter ==  "S" %}
								{% set secondLetter = technique | slice(1) %}
								{% if "C" == secondLetter %}
									{% set path = "client-side-script" %}
								{% else %}
									{% set path = "smil" %}
								{% endif %}
							{% endif %}
							<li class="fr-text--sm"><a target="_blank" title="{{ technique }} - nouvelle fenêtre" href="https://www.w3.org/WAI/WCAG21/Techniques/{{ path }}/{{ technique }}">{{ technique }}</a></li>
							{% endfor %}
						</ul>
					{% endif %}
				</div>
				</div>
			</div>
		</li>
	{% endfor %}
	</ul>
</div>
{% endblock %}


